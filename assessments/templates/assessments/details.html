{% extends 'base/base.html' %}

{% block content %}
    <h1 class="display-4">{{assessment}}</h1>
    <p>{{ assessment.course_name }}</p>
    <hr />
    {% if newly_created %}
        <h3 class="h6 fw-normal text-success-emphasis">Assessment created successfully!</h3>
        <p>An email with a secret ID has been sent to <code>nkhatho.class@gmail.com</code>. You can use this ID to access student submissions. Alternatively, you can copy and save the secret ID below.</p>
        <div class="input-group" style="width: 50%">
          <input id="secret-id" type="text" class="form-control" value="{{ assessment.uuid }}">
          <button id="copy-button" class="btn btn-secondary" type="button">Copy</button>
        </div>
        <p class="mt-4">To access the submissions, navigate to the assessment details page and enter the secret ID when prompted. Please keep this ID secure and do not share it with anyone who should not have access.</p>
    {% else %}
        <table class="table table-striped">
            <thead>
                <tr>
                    <th scope="col">Student</th>
                    <th scope="col">IP Address</th>
                    <th scope="col">Submission Time</th>
                    <th scope="col"></th>
                </tr>
            </thead>
            <tbody>
                {% for submission in submissions %}
                    <tr>
                        <td>{{ submission.student }}</td>
                        <td>{{ submission.ip_address }}</td>
                        <td>{{ submission.submitted_at|date:"d/m/Y H:i:s"  }}</td>
                        <td><a href="{{ submission.attachment.url }}" download>Download</a></td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}
{% endblock %}

{% block scripts %}
    <script>
        const copyButton = document.getElementById('copy-button');
        const secretKey = document.getElementById('secret-id');
        copyButton.addEventListener('click', function(event) {
            navigator.clipboard.writeText(secretKey.value)
              .catch((err) => {
                console.error('Error copying text: ', err);
                secretKey.select();
                document.execCommand('copy');
              });
        });


    </script>
{% endblock %}